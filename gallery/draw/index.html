<!DOCTYPE html>

<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">

		<title>Symmetrical Drawing</title>

		<link rel="stylesheet" href="estils.css">
		<script src="../../recursos/llibreries/p5js/p5.js"></script>
	</head>

	<body>
		<div id="app">
			<div id="varsControllers">
				<input type="range" id="inpSymmetries" min="1" max="24" step="1" value="8" />
				<input type="range" id="inpAlfa" min="0" max=".5" step="0.01" value="0.1" />
				<input type="range" id="inpSize" min="5" max="50" step="1" value="10" />
			</div>
			<div id="buttonsControllers">
				<button id="btnRefresh">Clean</button>
				<button id="btnMode">Switch mode</button>
				<button id="btnReset">Reset slides</button>
			</div>
		</div>
	</body>

	<script>
		var iptSym, iptAlfa, iptSize;
		var fillColor = [0, 80, 35]; // var fillColor = [0, 80, 25];
		var paintMode = false;
		var lastPoint = [];

		function setup() {
			createCanvas(window.innerWidth, window.innerHeight);
			frameRate(48);

			setEvents();
			clearCanvas();

			lastPoint = [width * .5, height * .5];
		}

		function draw() {
			updateColor();
			if (mouseIsPressed)
				drawSymmetrically();
			lastPoint = [mouseX, mouseY];
		}

		function updateColor() {
			var bg = color(12);
			bg.setAlpha(iptAlfa.value);
			background(bg);

			fillColor[0]++;
			if (fillColor[0] > 360) fillColor[0] = 0;
			stroke(fillColor);
		}

		function drawSymmetrically() {
			translate(width/2, height/2);
			const x = mouseX - width * 0.5;
			const y = mouseY - height * 0.5;
			const lx = lastPoint[0] - width * 0.5;
			const ly = lastPoint[1] - height * 0.5;
			strokeWeight(iptSize.value);
			for (var i = 0; i < iptSym.value; i++) {
				push();
				rotate(TWO_PI * i / iptSym.value);
				if (paintMode) point(x, y);
				else line(x, y, lx, ly);
				pop();
			}
		}

		function clearCanvas() {
			colorMode(HSL);
			angleMode(RADIANS);
			background(12);
		}

		function setEvents() {
			document.getElementById('btnRefresh').addEventListener('click', clearCanvas);
			document.getElementById('btnMode').addEventListener('click', function(){ paintMode = !paintMode });
			document.getElementById('btnReset').addEventListener('click', function(){ 
				iptSym.value = 8;
				iptAlfa.value = .1;
				iptSize.value = 10;
			});
			iptSym = document.getElementById('inpSymmetries');
			iptAlfa = document.getElementById('inpAlfa');
			iptSize = document.getElementById('inpSize');
		}
	</script>

</html>
